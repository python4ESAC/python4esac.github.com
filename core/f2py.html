

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Optimization &mdash; Python4Astronomers 1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
<<<<<<< HEAD
    <link rel="top" title="Python4Astronomers v1.1 documentation" href="../index.html" />
    <link rel="up" title="Core packages for analysis: IPython, NumPy, and SciPy" href="core.html" />
    <link rel="next" title="Plotting and Images" href="../plotting/plotting.html" />
    <link rel="prev" title="Scipy stats" href="scipy_stats.html" />
=======
    <link rel="top" title="Python4Astronomers 1.1 documentation" href="../index.html" />
>>>>>>> 7f4c677100973efb57118f592cbd175db5b1b42e
 
<script type="text/javascript"> 
$(document).ready(function(){

$(".flip0").click(function(){
    $(".panel0").slideToggle("normal");
  });

$(".flip1").click(function(){
    $(".panel1").slideToggle("normal");
  });

$(".flip2").click(function(){
    $(".panel2").slideToggle("normal");
  });

$(".flip3").click(function(){
    $(".panel3").slideToggle("normal");
  });

$(".flip4").click(function(){
    $(".panel4").slideToggle("normal");
  });

$(".flip5").click(function(){
    $(".panel5").slideToggle("normal");
  });

$(".flip6").click(function(){
    $(".panel6").slideToggle("normal");
  });

$(".flip7").click(function(){
    $(".panel7").slideToggle("normal");
  });

$(".flip8").click(function(){
    $(".panel8").slideToggle("normal");
  });

$(".flip9").click(function(){
    $(".panel9").slideToggle("normal");
  });

});
</script>
 
<style type="text/css"> 

div.panel0,p.flip0
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip0
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel0
{
display:none;
}

div.panel1,p.flip1
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip1
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel1
{
display:none;
}

div.panel2,p.flip2
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip2
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel2
{
display:none;
}

div.panel3,p.flip3
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip3
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel3
{
display:none;
}

div.panel4,p.flip4
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip4
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel4
{
display:none;
}

div.panel5,p.flip5
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip5
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel5
{
display:none;
}

div.panel6,p.flip6
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip6
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel6
{
display:none;
}

div.panel7,p.flip7
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip7
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel7
{
display:none;
}

div.panel8,p.flip8
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip8
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel8
{
display:none;
}

div.panel9,p.flip9
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip9
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel9
{
display:none;
}

</style>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18709417-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
<<<<<<< HEAD
        <li class="right" >
          <a href="../plotting/plotting.html" title="Plotting and Images"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="scipy_stats.html" title="Scipy stats"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Python4Astronomers v1.1 documentation</a> &raquo;</li>
          <li><a href="core.html" accesskey="U">Core packages for analysis: IPython, NumPy, and SciPy</a> &raquo;</li> 
=======
        <li><a href="../index.html">Python4Astronomers 1.1 documentation</a> &raquo;</li> 
>>>>>>> 7f4c677100973efb57118f592cbd175db5b1b42e
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Optimization</a><ul>
<li><a class="reference internal" href="#connecting-programming-languages-with-f2py">Connecting programming languages with F2py</a><ul>
<li><a class="reference internal" href="#fortran">FORTRAN</a></li>
<li><a class="reference internal" href="#c">C</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiprocessing">Multiprocessing</a></li>
<li><a class="reference internal" href="#running-and-controlling-shell-programs">Running and controlling shell programs</a></li>
</ul>
</li>
</ul>

<<<<<<< HEAD
  <h4>Previous topic</h4>
  <p class="topless"><a href="scipy_stats.html"
                        title="previous chapter">Scipy stats</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../plotting/plotting.html"
                        title="next chapter">Plotting and Images</a></p>
=======
>>>>>>> 7f4c677100973efb57118f592cbd175db5b1b42e
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/core/f2py.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="optimization">
<h1><a class="toc-backref" href="#id1">Optimization</a><a class="headerlink" href="#optimization" title="Permalink to this headline">¶</a></h1>
<p>This page mentions three ways in which code or code usage can be optimized:</p>
<ul class="simple">
<li>by incorporating existing <em>subroutines</em> from other languages into Python code
(<cite>Python as a glue-language</cite>)</li>
<li>by simple parallelization</li>
<li>by controlling existing full-blown shell programs from within Python</li>
</ul>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#optimization" id="id1">Optimization</a><ul>
<li><a class="reference internal" href="#connecting-programming-languages-with-f2py" id="id2">Connecting programming languages with F2py</a><ul>
<li><a class="reference internal" href="#fortran" id="id3">FORTRAN</a></li>
<li><a class="reference internal" href="#c" id="id4">C</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiprocessing" id="id5">Multiprocessing</a></li>
<li><a class="reference internal" href="#running-and-controlling-shell-programs" id="id6">Running and controlling shell programs</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="connecting-programming-languages-with-f2py">
<h2><a class="toc-backref" href="#id2">Connecting programming languages with F2py</a><a class="headerlink" href="#connecting-programming-languages-with-f2py" title="Permalink to this headline">¶</a></h2>
<p>Python is one of the easiest languages to learn, and one of the most efficient
to write. Variables need not to be declared, and can even change type within
a single Python program. The <em>batteries included</em> strategy, and the availability
of numpy, scipy and pylab allow the programmer to immediately focus on the
problem at hand, without bothering with the details. Such a high-level language
obviously must come at a price: speed. Although numpy and scipy already solve
many of the speed issues, sometimes a problem is just to complicated to be
easily integrated in the numpy and scipy framework. Also, many people, companies
or institutes have a huge tradition in a particular field, resulting in a lot of
code written in Fortran and C, that is fast <em>and</em> reliable, albeit perhaps not
easy in use. It would be a tremendous waste of effort to reimplement everything
in Python, probably ending up with a program which is a lot slower and less
reliable than the original source code.</p>
<p>Luckily, Python easily interfaces with existing codes, in particular Fortran and
C. This tutorial focuses on Fortran, but in fact much more tools are available
for C.</p>
<p>An example of the interface capabilities of Python to Fortran and C is already
apparent in numpy and scipy. Most of the optimization and linear algebra code are
in fact wrappers around existing packages such as LAPACK and BLAS. Essentially,
<strong>numpy and scipy do not re-invent the wheel</strong>. Specifically
for this purpose, an <tt class="docutils literal"><span class="pre">f2py</span></tt> program is installed alongside numpy, which converts
Fortran and C code to a Python library. It is important to mention that this
program does <strong>not</strong> convert Fortran code <em>to</em> Python code (that would be slow),
but instead compiles the Fortrano code to a &#8216;shared library&#8217;, which Python
immediately understands.</p>
<p>An immediate disclaimer is the following: <tt class="docutils literal"><span class="pre">f2py</span></tt> only works with subroutines,
and not programs. Just like any other Python function, a Fortran subroutine
generally has <em>input</em> and <em>output</em>. Little change in the code is required for
Python to understand what is input, and what is output. In fact, it is only
necessary to add some comment statements. This implies that <strong>the Fortran code
you use to generate Python modules does not need any adjustments</strong>.</p>
<div class="section" id="fortran">
<h3><a class="toc-backref" href="#id3">FORTRAN</a><a class="headerlink" href="#fortran" title="Permalink to this headline">¶</a></h3>
<p>In this example, we want to ditch the FFT in favour of an explicit Fourier
transform. A reason could be that one perhaps wants to oversample a Fourier
transformation in a narrow passband, but the number of datapoints do not allow
for much zeropadding. In that case, one could write an explicit Fourier
transform in Fortran.</p>
<p class="flip0">Click to Show/Hide FORTRAN Code</p> <div class="panel0"><div class="highlight-fortran"><div class="highlight"><pre>      <span class="k">subroutine </span><span class="nv">fourier</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">X</span><span class="p">,</span><span class="nv">F0</span><span class="p">,</span><span class="nv">DF</span><span class="p">,</span><span class="nv">N</span><span class="p">,</span><span class="nv">NF</span><span class="p">,</span><span class="nv">FR</span><span class="p">,</span><span class="nv">S1</span><span class="p">)</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">T</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">X</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">F0</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">DF</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">N</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="nv">NF</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">out</span><span class="p">)</span> <span class="nv">FR</span>
<span class="nv">Cf2py</span> <span class="k">intent</span><span class="p">(</span><span class="nv">out</span><span class="p">)</span> <span class="nv">S1</span>
      <span class="k">implicit </span><span class="kt">real</span><span class="o">*</span><span class="mi">8</span> <span class="p">(</span><span class="nv">a</span><span class="o">-</span><span class="nv">h</span><span class="p">,</span><span class="nv">o</span><span class="o">-</span><span class="nv">z</span><span class="p">)</span>
      <span class="k">dimension </span><span class="nv">T</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span><span class="nv">X</span><span class="p">(</span><span class="nv">N</span><span class="p">)</span>
      <span class="k">dimension </span><span class="nv">FR</span><span class="p">(</span><span class="nv">NF</span><span class="p">),</span><span class="nv">S1</span><span class="p">(</span><span class="nv">NF</span><span class="p">)</span>
      <span class="kt">DOUBLE PRECISION </span><span class="nv">TPF</span><span class="p">,</span><span class="nv">F0</span><span class="p">,</span><span class="nv">DF</span>
      <span class="kt">DOUBLE PRECISION </span><span class="nv">COX</span><span class="p">,</span><span class="nv">SOX</span><span class="p">,</span><span class="nv">TF</span>
      <span class="kt">DOUBLE PRECISION </span><span class="nv">S0</span><span class="p">,</span><span class="nv">C0</span>
      <span class="k">DATA </span><span class="nv">TWOPI</span><span class="o">/</span><span class="mf">6.28318530717959</span><span class="nv">D0</span><span class="o">/</span>

      <span class="nv">TPF</span> <span class="o">=</span> <span class="nv">F0</span><span class="o">*</span><span class="nv">TWOPI</span>
      <span class="k">do </span><span class="mi">11</span> <span class="nv">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">NF</span>
      <span class="nv">C0X</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="nv">S0X</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="k">do </span><span class="mi">12</span> <span class="nv">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nv">N</span>
      <span class="nv">TF</span> <span class="o">=</span> <span class="nv">T</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="o">*</span><span class="nv">TPF</span>
      <span class="nv">S0</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="nv">TF</span><span class="p">)</span>
      <span class="nv">C0</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="nv">TF</span><span class="p">)</span>
      <span class="nv">C0X</span> <span class="o">=</span> <span class="nv">C0X</span> <span class="o">+</span> <span class="nv">C0</span> <span class="o">*</span> <span class="nv">X</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span>
      <span class="nv">S0X</span> <span class="o">=</span> <span class="nv">S0X</span> <span class="o">+</span> <span class="nv">S0</span> <span class="o">*</span> <span class="nv">X</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span>
<span class="mi">12</span>    <span class="k">end do</span>
<span class="k">      </span><span class="nv">S1</span><span class="p">(</span><span class="nv">K</span><span class="p">)</span> <span class="o">=</span> <span class="nv">C0X</span><span class="o">*</span><span class="nv">C0X</span> <span class="o">+</span> <span class="nv">S0X</span><span class="o">*</span><span class="nv">S0X</span>
      <span class="nv">FR</span><span class="p">(</span><span class="nv">K</span><span class="p">)</span> <span class="o">=</span> <span class="nv">TPF</span><span class="o">/</span><span class="nv">TWOPI</span>
      <span class="nv">TPF</span><span class="o">=</span><span class="nv">TPF</span><span class="o">+</span><span class="nv">DF</span><span class="o">*</span><span class="nv">TWOPI</span>
<span class="mi">11</span>    <span class="k">end do</span>
<span class="k">      RETURN</span>
<span class="k">      END</span>
</pre></div>
</div>
</div><p>After writing the Fortran routine and saving it to a file <tt class="docutils literal"><span class="pre">fourier.f</span></tt>,
we can run the <tt class="docutils literal"><span class="pre">f2py</span></tt> program:</p>
<div class="highlight-python"><pre>$:&gt; f2py -c fourier.f -m ffourier</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">-c</span></tt> options tells us in which file(s) the Fortran code is located, the
<tt class="docutils literal"><span class="pre">-m</span></tt> tells you the name of the Python module the Fortran code will be converted
to. If the Fortran code has other <tt class="docutils literal"><span class="pre">*.f</span></tt> dependencies, you can easily compile them all in the same Python module:</p>
<div class="highlight-python"><pre>$:&gt; f2py -c *.f -m ffourier</pre>
</div>
<p>The result should be an <tt class="docutils literal"><span class="pre">*.so</span></tt> file, which is a &#8216;shared library object&#8217;. This
shared library can be treated as a normal Python module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ffourier</span> <span class="c"># this is our Fortran module</span>

<span class="c"># generate a time series with a frequency at 0.1 Hz</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="n">times</span><span class="p">)</span>

<span class="c"># compute the fourier on a limited region between 0.05 and 0.15 Hz</span>
<span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span><span class="mf">0.00005</span><span class="p">,</span><span class="mi">2000</span>
<span class="n">freqf</span><span class="p">,</span><span class="n">amplf</span> <span class="o">=</span> <span class="n">ffourier</span><span class="o">.</span><span class="n">fourier</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqf</span><span class="p">,</span><span class="n">amplf</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ffourier.png"><img alt="../_images/ffourier.png" src="../_images/ffourier.png" style="width: 400.0px; height: 300.0px;" /></a>
</div>
<div class="section" id="c">
<h3><a class="toc-backref" href="#id4">C</a><a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<p>Similar things as for FORTRAN can be done with C/C++. In fact, the number of tools
available for C/C++ are much more numerous (<a class="reference external" href="http://www.swig.org/">SWIG</a>, <a class="reference external" href="http://www.scipy.org/Weave">scipy.weave</a>, <a class="reference external" href="http://docs.python.org/extending/extending.html">Python docs</a>,...). However, also F2Py
has (somewhat limited) functionality with C code.</p>
<p>Suppose we have a C implemenation of the Fortran function <tt class="docutils literal"><span class="pre">fourier</span></tt> given above.</p>
<p class="flip1">Click to Show/Hide C Code</p> <div class="panel1"><div class="highlight-c"><div class="highlight"><pre><span class="cp"># include &lt;stdio.h&gt;</span>
<span class="cp"># include &lt;math.h&gt;</span>

<span class="kt">double</span> <span class="o">*</span> <span class="nf">fourier</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">f0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">df</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nf2</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">fr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">twopi</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">c0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">c0x</span><span class="p">,</span><span class="n">s0x</span><span class="p">,</span><span class="n">tpf</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>

    <span class="n">twopi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">M_PI</span><span class="p">;</span>

    <span class="n">tpf</span> <span class="o">=</span> <span class="n">f0</span><span class="o">*</span><span class="n">twopi</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">nf</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">c0x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">s0x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tpf</span><span class="p">;</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">tf</span><span class="p">);</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">tf</span><span class="p">);</span>
            <span class="n">c0x</span> <span class="o">=</span> <span class="n">c0x</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">s0x</span> <span class="o">=</span> <span class="n">s0x</span> <span class="o">+</span> <span class="n">s0</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">fr</span><span class="p">[</span><span class="n">nf</span><span class="o">+</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0x</span><span class="o">*</span><span class="n">c0x</span> <span class="o">+</span> <span class="n">s0x</span><span class="o">*</span><span class="n">s0x</span><span class="p">;</span>
        <span class="n">fr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">/</span><span class="n">twopi</span><span class="p">;</span>
        <span class="n">tpf</span> <span class="o">=</span> <span class="n">tpf</span> <span class="o">+</span> <span class="n">df</span><span class="o">*</span><span class="n">twopi</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">fr</span><span class="p">;</span>


<span class="p">}</span>
</pre></div>
</div>
</div><p>In contrast to the Fortran subroutine, we need to explicitly write a header
file that explains which variables are intended as input, and which are
intended as output, and save it to a file <tt class="docutils literal"><span class="pre">fourier.pyf</span></tt>:</p>
<div class="highlight-python"><pre>python module cfourier
interface
    subroutine fourier(n,t,x,f0,df,nf,nf2,fr) result (fr)
    intent(c) fourier
    intent(c)
    integer intent(hide), depend(t) :: n=len(t)
    double precision intent(in) :: t(n)
    double precision intent(in) :: x(n)
    double precision intent(in) :: f0
    double precision intent(in) :: df
    integer intent(in) :: nf
    integer intent(hide), depend(fr) :: nf2=len(fr)
    double precision intent(in,out) :: fr(nf2)
    end subroutine fourier
end interface
end python module cfourier</pre>
</div>
<p>We run the F2Py program on the header file and source code:</p>
<div class="highlight-python"><pre>$:&gt; f2py fourier.pyf fourier.c -c</pre>
</div>
<p>And can finally use as a normal Python module. Note that the C function has
a slightly different calling signature.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ffourier</span> <span class="c"># this is our Fortran module</span>
<span class="kn">import</span> <span class="nn">cfourier</span> <span class="c"># this is our C module</span>

<span class="c"># generate a time series with a frequency at 0.1 Hz</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="n">times</span><span class="p">)</span>

<span class="c"># compute the fourier on a limited region between 0.05 and 0.15 Hz</span>
<span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span><span class="mf">0.00005</span><span class="p">,</span><span class="mi">2000</span>
<span class="n">freqf</span><span class="p">,</span><span class="n">amplf</span> <span class="o">=</span> <span class="n">ffourier</span><span class="o">.</span><span class="n">fourier</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">)</span>
<span class="n">freqc</span><span class="p">,</span><span class="n">amplc</span> <span class="o">=</span> <span class="n">cfourier</span><span class="o">.</span><span class="n">fourier</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqf</span><span class="p">,</span><span class="n">amplf</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqc</span><span class="p">,</span><span class="n">amplc</span><span class="p">,</span><span class="s">&#39;r--&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/cffourier.png"><img alt="../_images/cffourier.png" src="../_images/cffourier.png" style="width: 400.0px; height: 300.0px;" /></a>
</div>
</div>
<div class="section" id="multiprocessing">
<h2><a class="toc-backref" href="#id5">Multiprocessing</a><a class="headerlink" href="#multiprocessing" title="Permalink to this headline">¶</a></h2>
<p>Usually, you want to write stuff in Fortran because it needs to be fast. Another
solution to write fast code is parallelization. Better yet, how cool would it be
to write Fortran code and parallelize it in Python?</p>
<p>The <a class="reference external" href="http://docs.python.org/library/multiprocessing.html">multiprocessing package</a>
was introduced as of Python 2.6. It is partially
inspired on the <tt class="docutils literal"><span class="pre">threading</span></tt> package. The difference with the latter is that
<tt class="docutils literal"><span class="pre">multiprocessing</span></tt> actually makes use of different cores, while <tt class="docutils literal"><span class="pre">threading</span></tt>
only allows different threads on one core.</p>
<p>The <tt class="docutils literal"><span class="pre">multiprocessing</span></tt> package provides high-level tools for parallelization,
such as exchanging objects between processes, synchronization, Pools and Queues. In the following
example, we divide the Fourier computations done above over all the cores that
are available on a computer. This can simply be done by dividing the domain
of the Fourier transform in pieces. We need to define a function that computes
one of these pieces. It is almost identical to the <tt class="docutils literal"><span class="pre">ffourier.fourier</span></tt> defined
before, except that we need also to pass the power-spectrum array to fill in as a
shared object (<tt class="docutils literal"><span class="pre">power</span></tt>), and we need to know which part of the Fourier
transform is beeing computed (given by the starting index <tt class="docutils literal"><span class="pre">start</span></tt>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fourier_process</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">power</span><span class="p">,</span><span class="n">start</span><span class="p">):</span>
    <span class="n">f1</span><span class="p">,</span><span class="n">s1</span> <span class="o">=</span> <span class="n">ffourier</span><span class="o">.</span><span class="n">fourier</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">)</span>
    <span class="n">power</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">nf</span><span class="p">]</span> <span class="o">=</span> <span class="n">s1</span>
</pre></div>
</div>
<p>Next, a function is need that divides the Fourier transform in the pieces,
and spawns a <tt class="docutils literal"><span class="pre">multiprocessing.Process</span></tt> with the adequate arguments. Note that
the number of cores available on a computer can simply be returned with the
function <tt class="docutils literal"><span class="pre">multiprocesssing.cpu_count()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fourier</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf</span><span class="p">):</span>
    <span class="n">nproc</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">))</span> <span class="c"># shared object for the power spectrum</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># a list containing all the processes that will be spawned</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nproc</span><span class="p">):</span>
        <span class="n">nf_run</span> <span class="o">=</span> <span class="n">nf</span><span class="o">/</span><span class="n">nproc</span> <span class="c"># how many frequency points need to be sampled per process</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">nf_run</span> <span class="c"># starting index</span>
        <span class="n">startf</span> <span class="o">=</span> <span class="n">f0</span><span class="o">+</span><span class="n">start</span><span class="o">*</span><span class="n">df</span> <span class="c"># starting frequency</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fourier_process</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">startf</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nf_run</span><span class="p">,</span><span class="n">arr</span><span class="p">,</span><span class="n">start</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c"># start the process</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># and add it to the list</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>        <span class="c"># wait until process has ended</span>
    <span class="k">return</span> <span class="n">f0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="c"># and return the results</span>
</pre></div>
</div>
</div>
<div class="section" id="running-and-controlling-shell-programs">
<h2><a class="toc-backref" href="#id6">Running and controlling shell programs</a><a class="headerlink" href="#running-and-controlling-shell-programs" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://docs.python.org/library/subprocess.html">subprocess module</a>
provides an interface to run programs (<tt class="docutils literal"><span class="pre">subprocess.call</span></tt>) and return the standard
output (<tt class="docutils literal"><span class="pre">subprocess.check_output</span></tt>). One can invoke programs in the shell (<tt class="docutils literal"><span class="pre">shell=True</span></tt>),
to still have access to shell features (wildcards, pipes, environment variables).</p>
<p>It is also possible to communicate with a program and its output <em>while it is
executed</em>, so you don&#8217;t have to wait until it terminates. This can be used
to check how a program is advancing, and maybe terminate it to restart it with
different input. We give an example of some of the possibilities, by running
a stupid Fortran program <tt class="docutils literal"><span class="pre">dummy</span></tt>, that writes out the numbers from 0 to 20
and their squared value, at a rate of 1 number per second.</p>
<div class="highlight-fortran"><div class="highlight"><pre>     <span class="k">PROGRAM </span><span class="nv">DUMMY</span>
     <span class="kt">real </span><span class="nv">match</span><span class="p">,</span><span class="nv">number</span>
     <span class="kt">integer </span><span class="nv">i</span>
     <span class="nv">number</span> <span class="o">=</span> <span class="mf">0.0</span>
     <span class="k">do </span><span class="mi">10</span><span class="p">,</span><span class="nv">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span>
       <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="nv">number</span><span class="p">,</span><span class="s1">&#39;**2 =&#39;</span><span class="p">,</span><span class="nv">number</span><span class="o">**</span><span class="mi">2</span>
       <span class="k">call </span><span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
       <span class="nv">number</span> <span class="o">=</span> <span class="nv">number</span><span class="o">+</span><span class="mf">1.0</span>
<span class="mi">10</span>   <span class="k">CONTINUE</span>
<span class="k">     end</span>
</pre></div>
</div>
<p>Which can be compiled to the default <tt class="docutils literal"><span class="pre">a.out</span></tt> by simply running:</p>
<div class="highlight-python"><pre>$:&gt; gfortran dummy.f</pre>
</div>
<p>or something similar.</p>
<p>Now the idea is to write a small Python wrapper around it, that reads in the
input and kills it when it reaches a certain number. For fun, we will also
stop the program for a few seconds when it reaches the number 5, to continue
afterwards again. Finally, we check if the number we gave was reached: if the
returncode is 0, it exited normally (and we did not reach the number), if the
returncode is nonzero, it was killed, and the number was reached.</p>
<p>The modules we need are of course <tt class="docutils literal"><span class="pre">subprocess</span></tt> to launch and control the
Fortran program, <tt class="docutils literal"><span class="pre">signal</span></tt> to stop, continue and kill a process, <tt class="docutils literal"><span class="pre">sys</span></tt> to
get user input from the terminal, and <tt class="docutils literal"><span class="pre">time</span></tt> let the program sleep between
the stop and continue signal.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
<p>Next, we need some kind of iterator that iterates over the output generated from
the Fortran program, waits until the next output is received, and ends after
the output stream is closed. This is simply done with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">line_at_a_time</span><span class="p">(</span><span class="n">fileobj</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">yield</span> <span class="n">line</span>
</pre></div>
</div>
<p>Finally, we write the <em>main</em> part of the program. It will get a the number to
stop the program at from the command line via the <tt class="docutils literal"><span class="pre">sys.argv</span></tt> variable, start
the Fortran program, catching its standard output to a pipe:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">match_number</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s">&#39;./a.out&#39;</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</pre></div>
</div>
<p>The return value <tt class="docutils literal"><span class="pre">p1</span></tt> is a <tt class="docutils literal"><span class="pre">Popen</span></tt> object. For a full description, see the
<a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.Popen">docs</a>. It has
an attribute called <tt class="docutils literal"><span class="pre">stdout</span></tt>, which is a file-like object than can be given
to the read function defined above. We will extract the current number from the
output of the Fortran program, and check if it matches The user-given variable
<tt class="docutils literal"><span class="pre">match_number</span></tt>. If it does, we send a kill signal <tt class="docutils literal"><span class="pre">SIGKILL</span></tt> to the process,
which will kill it. If the number reaches 5, we sill stop it, wait for 5 seconds
and continue again. Else, the program will just report the last line it received
from the Fortran program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_at_a_time</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="n">check</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">check</span><span class="o">==</span><span class="n">match_number</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;I got: &quot;{0}&quot;; and it is a match! Killing program now...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span> <span class="c"># equivalent to os.kill(p1.pid,signal.SIGKILL)</span>
    <span class="k">elif</span> <span class="n">check</span><span class="o">==</span><span class="mf">5.</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;I got: &quot;{0}&quot;; that is a nice number, I will just wait here for a moment...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGSTOP</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;... waited long enough, continuing...&#39;</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGCONT</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;I got: &quot;{0}&quot;; but we are not yet at {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">match_number</span><span class="p">))</span>
</pre></div>
</div>
<p>And finally, we make sure the Fortran program is finished, and ask for its
return code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">retcode</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="k">if</span> <span class="n">retcode</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;The program exited normally (return code: {0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retcode</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;The program terminated prematurely (return code: {0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retcode</span><span class="p">))</span>
</pre></div>
</div>
<p>After saving the code to the file <tt class="docutils literal"><span class="pre">program_control_shell.py</span></tt>, we can run
it with:</p>
<div class="highlight-python"><pre>$:&gt; python program_control_shell.py 10
  I got: "0.0000000     **2 =   0.0000000"; but we are not yet at 10.0
  I got: "1.0000000     **2 =   1.0000000"; but we are not yet at 10.0
  I got: "2.0000000     **2 =   4.0000000"; but we are not yet at 10.0
  I got: "3.0000000     **2 =   9.0000000"; but we are not yet at 10.0
  I got: "4.0000000     **2 =   16.000000"; but we are not yet at 10.0
  I got: "5.0000000     **2 =   25.000000"; that is a nice number, I will just wait here for a moment...
  ... waited long enough, continuing...
  I got: "6.0000000     **2 =   36.000000"; but we are not yet at 10.0
  I got: "7.0000000     **2 =   49.000000"; but we are not yet at 10.0
  I got: "8.0000000     **2 =   64.000000"; but we are not yet at 10.0
  I got: "9.0000000     **2 =   81.000000"; but we are not yet at 10.0
  I got: "10.000000     **2 =   100.00000"; and it is a match! Killing program now...
  The program terminated prematurely (return code: -9)</pre>
</div>
<p>or:</p>
<div class="highlight-python"><pre>$:&gt; python program_control_shell.py 25
  I got: "0.0000000     **2 =   0.0000000"; but we are not yet at 25.0
  I got: "1.0000000     **2 =   1.0000000"; but we are not yet at 25.0
  I got: "2.0000000     **2 =   4.0000000"; but we are not yet at 25.0
  I got: "3.0000000     **2 =   9.0000000"; but we are not yet at 25.0
  I got: "4.0000000     **2 =   16.000000"; but we are not yet at 25.0
  I got: "5.0000000     **2 =   25.000000"; that is a nice number, I will just wait here for a moment...
  ... waited long enough, continuing...
  I got: "6.0000000     **2 =   36.000000"; but we are not yet at 25.0
  I got: "7.0000000     **2 =   49.000000"; but we are not yet at 25.0
  I got: "8.0000000     **2 =   64.000000"; but we are not yet at 25.0
  I got: "9.0000000     **2 =   81.000000"; but we are not yet at 25.0
  I got: "10.000000     **2 =   100.00000"; but we are not yet at 25.0
  I got: "11.000000     **2 =   121.00000"; but we are not yet at 25.0
  I got: "12.000000     **2 =   144.00000"; but we are not yet at 25.0
  I got: "13.000000     **2 =   169.00000"; but we are not yet at 25.0
  I got: "14.000000     **2 =   196.00000"; but we are not yet at 25.0
  I got: "15.000000     **2 =   225.00000"; but we are not yet at 25.0
  I got: "16.000000     **2 =   256.00000"; but we are not yet at 25.0
  I got: "17.000000     **2 =   289.00000"; but we are not yet at 25.0
  I got: "18.000000     **2 =   324.00000"; but we are not yet at 25.0
  I got: "19.000000     **2 =   361.00000"; but we are not yet at 25.0
  I got: "20.000000     **2 =   400.00000"; but we are not yet at 25.0
  The program exited normally (return code: 0)</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
<<<<<<< HEAD
        <li class="right" >
          <a href="../plotting/plotting.html" title="Plotting and Images"
             >next</a> |</li>
        <li class="right" >
          <a href="scipy_stats.html" title="Scipy stats"
             >previous</a> |</li>
        <li><a href="../index.html">Python4Astronomers v1.1 documentation</a> &raquo;</li>
          <li><a href="core.html" >Core packages for analysis: IPython, NumPy, and SciPy</a> &raquo;</li> 
=======
        <li><a href="../index.html">Python4Astronomers 1.1 documentation</a> &raquo;</li> 
>>>>>>> 7f4c677100973efb57118f592cbd175db5b1b42e
      </ul>
    </div>
 <small>Copyright:
 Smithsonian Astrophysical Observatory under terms of
 <a rel="license"
 href="http://creativecommons.org/licenses/by/3.0/">CC
 Attribution 3.0</a></small> <a rel="license"
 href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons
 License" style="border-width:0"
 src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a>

  </body>
</html>