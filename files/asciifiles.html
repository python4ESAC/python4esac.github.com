

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Several ways to handle ASCII data &mdash; Python4Astronomers 1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Python4Astronomers 1.1 documentation" href="../index.html" />
    <link rel="up" title="Reading and Writing files" href="files.html" />
    <link rel="next" title="Binary formats useful for astronomers" href="binaryfiles.html" />
    <link rel="prev" title="Python Built-in Types and Operations" href="../python/types.html" />
 
<script type="text/javascript"> 
$(document).ready(function(){

$(".flip0").click(function(){
    $(".panel0").slideToggle("normal");
  });

$(".flip1").click(function(){
    $(".panel1").slideToggle("normal");
  });

$(".flip2").click(function(){
    $(".panel2").slideToggle("normal");
  });

$(".flip3").click(function(){
    $(".panel3").slideToggle("normal");
  });

$(".flip4").click(function(){
    $(".panel4").slideToggle("normal");
  });

$(".flip5").click(function(){
    $(".panel5").slideToggle("normal");
  });

$(".flip6").click(function(){
    $(".panel6").slideToggle("normal");
  });

$(".flip7").click(function(){
    $(".panel7").slideToggle("normal");
  });

$(".flip8").click(function(){
    $(".panel8").slideToggle("normal");
  });

$(".flip9").click(function(){
    $(".panel9").slideToggle("normal");
  });

});
</script>
 
<style type="text/css"> 

div.panel0,p.flip0
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip0
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel0
{
display:none;
}

div.panel1,p.flip1
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip1
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel1
{
display:none;
}

div.panel2,p.flip2
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip2
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel2
{
display:none;
}

div.panel3,p.flip3
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip3
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel3
{
display:none;
}

div.panel4,p.flip4
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip4
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel4
{
display:none;
}

div.panel5,p.flip5
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip5
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel5
{
display:none;
}

div.panel6,p.flip6
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip6
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel6
{
display:none;
}

div.panel7,p.flip7
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip7
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel7
{
display:none;
}

div.panel8,p.flip8
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip8
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel8
{
display:none;
}

div.panel9,p.flip9
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip9
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel9
{
display:none;
}

</style>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18709417-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="binaryfiles.html" title="Binary formats useful for astronomers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../python/types.html" title="Python Built-in Types and Operations"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Python4Astronomers 1.1 documentation</a> &raquo;</li>
          <li><a href="files.html" accesskey="U">Reading and Writing files</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Several ways to handle ASCII data</a><ul>
<li><a class="reference internal" href="#reading-and-writing-files-in-pure-python">Reading and Writing files in Pure Python</a></li>
<li><a class="reference internal" href="#numpy">Numpy</a></li>
<li><a class="reference internal" href="#asciitable">Asciitable</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../python/types.html"
                        title="previous chapter">Python Built-in Types and Operations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="binaryfiles.html"
                        title="next chapter">Binary formats useful for astronomers</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/files/asciifiles.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="several-ways-to-handle-ascii-data">
<h1>Several ways to handle ASCII data<a class="headerlink" href="#several-ways-to-handle-ascii-data" title="Permalink to this headline">¶</a></h1>
<p>Astronomers love storing tabular data in human-readable ASCII tables.
Unfortunately there is very little agreement on a standard way to do this,
unlike e.g. FITS.</p>
<div class="section" id="reading-and-writing-files-in-pure-python">
<h2>Reading and Writing files in Pure Python<a class="headerlink" href="#reading-and-writing-files-in-pure-python" title="Permalink to this headline">¶</a></h2>
<div class="section" id="reading">
<h3>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h3>
<p>We have already talked about <a class="reference internal" href="../python/types.html#python-built-in-types-and-operations"><em>Python Built-in Types and Operations</em></a>, but
there are more types that we did not speak about. One of these is the
<tt class="docutils literal"><span class="pre">file()</span></tt> object which can be used to read or write files.</p>
<p>Let&#8217;s start off by downloading <a class="reference download internal" href="../_downloads/data.txt"><tt class="xref download docutils literal"><span class="pre">this</span></tt></a> data file, then launching IPython the directory where you have the file:</p>
<div class="highlight-python"><pre>$ ipython -pylab</pre>
</div>
<p>If you have trouble downloading the file, then start up IPython (<tt class="docutils literal"><span class="pre">ipython</span> <span class="pre">--pylab</span></tt>) and enter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://python4astronomers.github.com/_downloads/data.txt&#39;</span>
<span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">ls</span>
</pre></div>
</div>
<p>Now let&#8217;s try and get the contents of the file into IPython. We start off by creating a file object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">'r'</span></tt> means that the file should be opened in <em>read</em> mode (i.e. you will get an error if the file does not exist). Now, simply type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>and you will see something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;RAJ        DEJ                          Jmag   e_Jmag\n2000 (deg) 2000</span>
<span class="go">(deg) 2MASS             (mag)  (mag) \n---------- ----------</span>
<span class="go">----------------- ------ ------\n010.684737 +41.269035 00424433+4116085</span>
<span class="go">9.453  0.052\n010.683469 +41.268585 00424403+4116069   9.321</span>
<span class="go">0.022\n010.685657 +41.269550 00424455+4116103  10.773  0.069\n010.686026</span>
<span class="go">+41.269226 00424464+4116092   9.299  0.063\n010.683465 +41.269676</span>
<span class="go">00424403+4116108  11.507  0.056\n010.686015 +41.269630</span>
<span class="go">00424464+4116106   9.399  0.045\n010.685270 +41.267124</span>
<span class="go">00424446+4116016  12.070  0.035\n&#39;</span>
</pre></div>
</div>
<p>The data file has been read in as a single string. Let&#8217;s try that again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
<p>What&#8217;s happened? We read the file, and the file &#8216;pointer&#8217; is now sitting at the end of the file, and there is nothing left to read. Let&#8217;s now try and do something more useful, and capture the contents of the file in a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>  <span class="c"># We need to re-open the file</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Now <tt class="docutils literal"><span class="pre">data</span></tt> contains a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">&lt;type &#39;str&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition-closing-files admonition ">
<p class="first admonition-title">Closing files</p>
<p>Usually, you should close file when you are done with it to free up
resources (memory).
If you only have a couple of files in an interactive session, that is not
dramatic. On the other hand, if you write scrits which deal with douzens of
files, then you should start worrying about these things. Often you will see
things like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c"># do things with your file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Notice the indent under the <tt class="docutils literal"><span class="pre">with</span></tt>. At the end of that block the
file is automatically closed, even if things went wrong and an error
occured inside the <tt class="docutils literal"><span class="pre">with</span></tt> block.</p>
</div>
<p>But what we&#8217;d really like to do is read the file line by line. There are several ways to do this, the simplest of which is to use a <tt class="docutils literal"><span class="pre">for</span></tt> loop in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the indent before <tt class="docutils literal"><span class="pre">print</span></tt>, which is necessary to indicate that we are inside the loop (there is no <tt class="docutils literal"><span class="pre">end</span> <span class="pre">for</span></tt> in Python). Note that we are using <tt class="docutils literal"><span class="pre">repr()</span></tt> to show any invisible characters (this will be useful in a minute). The output should now look something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
<span class="go">        print repr(line)</span>

<span class="go">&#39;RAJ        DEJ                          Jmag   e_Jmag\n&#39;</span>
<span class="go">&#39;2000 (deg) 2000 (deg) 2MASS             (mag)  (mag) \n&#39;</span>
<span class="go">&#39;---------- ---------- ----------------- ------ ------\n&#39;</span>
<span class="go">&#39;010.684737 +41.269035 00424433+4116085   9.453  0.052\n&#39;</span>
<span class="go">&#39;010.683469 +41.268585 00424403+4116069   9.321  0.022\n&#39;</span>
<span class="go">&#39;010.685657 +41.269550 00424455+4116103  10.773  0.069\n&#39;</span>
<span class="go">&#39;010.686026 +41.269226 00424464+4116092   9.299  0.063\n&#39;</span>
<span class="go">&#39;010.683465 +41.269676 00424403+4116108  11.507  0.056\n&#39;</span>
<span class="go">&#39;010.686015 +41.269630 00424464+4116106   9.399  0.045\n&#39;</span>
<span class="go">&#39;010.685270 +41.267124 00424446+4116016  12.070  0.035\n&#39;</span>
</pre></div>
</div>
<p>Each line is being returned as a string. Notice the <tt class="docutils literal"><span class="pre">\n</span></tt> at the end of each line - this is a line return character, which indicates the end of a line.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You may also come across the following way to read files line by
line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">f.readlines()</span></tt> actually reads in the whole file and splits it
into a list of lines, so for large files this can be memory
intensive. Using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p class="last">instead is more memory efficient because it only reads one line
at a time.</p>
</div>
<p>Now we&#8217;re reading in a file line by line, what would be really nice would be to get some values out of it.  Let&#8217;s examine the last line in detail. If we just type <tt class="docutils literal"><span class="pre">line</span></tt> we should see the last line that was printed in the loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line</span>
<span class="go">&#39;010.685270 +41.267124 00424446+4116016  12.070  0.035\n&#39;</span>
</pre></div>
</div>
<p>We can first get rid of the <tt class="docutils literal"><span class="pre">\n</span></tt> character with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span>
<span class="go">&#39;010.685270 +41.267124 00424446+4116016  12.070  0.035&#39;</span>
</pre></div>
</div>
<p>Next, we can use what we learned about strings and lists to do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">columns</span>
<span class="go">[&#39;010.685270&#39;, &#39;+41.267124&#39;, &#39;00424446+4116016&#39;, &#39;12.070&#39;, &#39;0.035&#39;]</span>
</pre></div>
</div>
<p>Finally, let&#8217;s say we care about the source name, and the J band magnitude. We can extract these with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span>
<span class="go">&#39;00424446+4116016&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">&#39;12.070&#39;</span>
</pre></div>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">j</span></tt> is a string, but if we want a floating point number, we can instead do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>One last piece of information we need about files is how we can read a single line. This is done using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</pre></div>
</div>
<p>We can put all this together to write a little script to read the data from the file and display the columns we care about to the screen! Here is is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Open file</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

<span class="c"># Read and ignore header lines</span>
<span class="n">header1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">header2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">header3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

<span class="c"># Loop over lines and extract variables of interest</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="n">j</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The output should look like this:</p>
<div class="highlight-python"><pre>00424433+4116085 9.453
00424403+4116069 9.321
00424455+4116103 10.773
00424464+4116092 9.299
00424403+4116108 11.507
00424464+4116106 9.399
00424446+4116016 12.07</pre>
</div>
<div class="admonition-exercise admonition ">
<p class="first admonition-title">Exercise</p>
<p>Try and see if you can understand what the following script is doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">header1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">header2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">header3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">source</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">source</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">source</span><span class="p">[</span><span class="s">&#39;j&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">After this script is run, how would you access the name and J-band magnitude of the third source?</p>
</div>
<p class="flip7">Click to Show/Hide Solution</p> <div class="panel7"><p>The following line creates an empty list to contain all the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>For each line, we are then creating an empty dictionary and populating it with variables we care about:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">source</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">source</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">source</span><span class="p">[</span><span class="s">&#39;j&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally, we append this source to the <tt class="docutils literal"><span class="pre">data</span></tt> list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p>Therefore, <tt class="docutils literal"><span class="pre">data</span></tt> is a list of dictionaries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">[{&#39;j&#39;: 9.453, &#39;name&#39;: &#39;00424433+4116085&#39;},</span>
<span class="go"> {&#39;j&#39;: 9.321, &#39;name&#39;: &#39;00424403+4116069&#39;},</span>
<span class="go"> {&#39;j&#39;: 10.773, &#39;name&#39;: &#39;00424455+4116103&#39;},</span>
<span class="go"> {&#39;j&#39;: 9.299, &#39;name&#39;: &#39;00424464+4116092&#39;},</span>
<span class="go"> {&#39;j&#39;: 11.507, &#39;name&#39;: &#39;00424403+4116108&#39;},</span>
<span class="go"> {&#39;j&#39;: 9.399, &#39;name&#39;: &#39;00424464+4116106&#39;},</span>
<span class="go"> {&#39;j&#39;: 12.07, &#39;name&#39;: &#39;00424446+4116016&#39;}]</span>
</pre></div>
</div>
<p>You can access the dictionary for the third source with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="go">{&#39;j&#39;: 10.773, &#39;name&#39;: &#39;00424455+4116103&#39;}</span>
</pre></div>
</div>
<p>To get the name of this source, you can therefore do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
<span class="go">&#39;00424455+4116103&#39;</span>
</pre></div>
</div>
</div></div>
<div class="section" id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h3>
<p>To open a file for writing, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data_new.txt&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then simply use <tt class="docutils literal"><span class="pre">f.write()</span></tt> to write any content to the file, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Hello, World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to write multiple lines, you can either give a list of strings to the <tt class="docutils literal"><span class="pre">writelines()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="s">&#39;spam</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;egg</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;spam</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or you can write them as a single string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;spam</span><span class="se">\n</span><span class="s">egg</span><span class="se">\n</span><span class="s">spam&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To close a file, simply use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>(this also applies to reading files)</p>
<div class="admonition-exercise admonition ">
<p class="first admonition-title">Exercise</p>
<p>Let&#8217;s try combining reading and writing. Using at most seven lines, write a script which will read in <tt class="docutils literal"><span class="pre">data.txt</span></tt>, replace any spaces with periods (<tt class="docutils literal"><span class="pre">.</span></tt>), and write the result out to a file called <tt class="docutils literal"><span class="pre">data_new.txt</span></tt>.</p>
<p class="last">Can you do it in a single line? (you can ignore closing the file)</p>
</div>
<p class="flip6">Click to Show/Hide Solution</p> <div class="panel6"><p>Here is a possible solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;.&#39;</span><span class="p">)</span>

<span class="n">f2</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;data_new.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="n">f2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>And a possible one-liner!:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">open</span><span class="p">(</span><span class="s">&#39;data_new.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="numpy">
<h2>Numpy<a class="headerlink" href="#numpy" title="Permalink to this headline">¶</a></h2>
<p>Numpy provides two functions to read in ASCII data. <tt class="docutils literal"><span class="pre">np.loadtxt</span></tt> is meant for relatively simple tables without missing values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>   <span class="c"># Pretends your variable is really a file</span>
                                <span class="c"># because loadtxt expect a filename as input</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s">&quot;0 1</span><span class="se">\n</span><span class="s">2 3&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a more complicated example, that is actually useful:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s"># Abundances of different elements</span>
<span class="s"># for TW Hya</span>
<span class="s"># taken from Guenther et al. (2007)</span>
<span class="s"># element, abund, error, first-ionisation-potential [eV]</span>
<span class="s">C  0.2  0.03 11.3</span>
<span class="s">N  0.51 0.05 14.6</span>
<span class="s">O  0.25 0.01 13.6</span>
<span class="s">Ne 2.46 0.08 21.6</span>
<span class="s">Fe 0.19 0.01  7.9</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;elem&#39;</span><span class="p">,</span> <span class="s">&#39;abund&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> \
    <span class="s">&#39;FIP&#39;</span><span class="p">),</span><span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">)})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;FIP&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;abund&#39;</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">],</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting plot clearly shows the inverse first ionization potential effect.
That means, that elements of a large FIP are enhanced in the corona.</p>
<p>The second command <tt class="docutils literal"><span class="pre">np.genfromtxt</span></tt> is more versatile. It can fill missing values in a table, read column names, exclude some columns etc. Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">#element abund error FIP</span>
<span class="s">C  0.2  0.03 11.3</span>
<span class="s">N  0.51 0.05 14.6</span>
<span class="s">O  0.25 0.01 13.6</span>
<span class="s">Ne 2.46 0.08 21.6</span>
<span class="s">S  nn   nn   10.4</span>
<span class="s">Fe 0.19 0.01  7.9</span>
<span class="s">other elements were not meesured</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">),</span> <span class="n">names</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> \
     <span class="n">skip_footer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">missing_values</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;nn&#39;</span><span class="p">),</span> <span class="n">filling_values</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
</pre></div>
</div>
<p>Examine what was returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span>
</pre></div>
</div>
<p>This is an instance of the NumPy <a class="reference external" href="http://docs.scipy.org/doc/numpy/user/basics.rec.html#module-numpy.doc.structured_arrays">structured array</a>
type, which is an efficient way to manipulate records of tabular data.  It stores
columns of typed data and you can access either a column of data or a row of
data at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s">&#39;abund&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="asciitable">
<h2>Asciitable<a class="headerlink" href="#asciitable" title="Permalink to this headline">¶</a></h2>
<p>If you need even more flexibility, than the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> module can help you.
It natively understands some very complex formats, e.g. the CDS machine readable tables and it can automatically detect any of those formats.
If also can format your output in LaTeX.</p>
<p>The <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> module is an extensible ASCII table reader and writer that is
designed to handle most formats you will encounter in the wild:</p>
<ul class="simple">
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Basic">asciitable.Basic</a>: basic table with customizable delimiters and header configurations</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Cds">asciitable.Cds</a>: <a class="reference external" href="http://vizier.u-strasbg.fr/doc/catstd.htx">CDS format table</a> (also Vizier and ApJ machine readable tables)</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.CommentedHeader">asciitable.CommentedHeader</a>: column names given in a line that begins with the comment character</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Daophot">asciitable.Daophot</a>: table from the IRAF DAOphot package</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Ipac">asciitable.Ipac</a>: <a class="reference external" href="http://irsa.ipac.caltech.edu/applications/DDGEN/Doc/ipac_tbl.html">IPAC format table</a></li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Latex">asciitable.Latex</a>,`asciitable.AASTex`_: Write your tables in LeTeX!</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Memory">asciitable.Memory</a>: table already in memory (list of lists, dict of lists, etc)</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.NoHeader">asciitable.NoHeader</a>: basic table with no header where columns are auto-named</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Rdb">asciitable.Rdb</a>: tab-separated values with an extra line after the column definition line</li>
<li><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#asciitable.Tab">asciitable.Tab</a>: tab-separated values</li>
</ul>
<p><a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">Asciitable</a> is built on a modular and extensible class structure. This makes
is easy to create new classes, which implement the functionality for some
specific table format.</p>
<div class="section" id="reading-tables">
<h3>Reading tables<a class="headerlink" href="#reading-tables" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">asciitable</span>
<span class="n">table</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">col1 col2 col3</span>
<span class="s">1    2    &quot;hi there&quot;</span>
<span class="s">3    4.2  world&quot;&quot;&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
<p>The first and most important argument to the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#reading-tables">asciitable.read()</a> function is
the table input.  There is some flexibility here and you can supply any of the following:</p>
<blockquote>
<div><ul class="simple">
<li>Name of a file (string)</li>
<li>Single string containing all table lines separated by newlines</li>
<li>File-like object with a callable read() method</li>
<li>List of strings where each list element is a table line</li>
</ul>
</div></blockquote>
<div class="section" id="guessing">
<h4>Guessing<a class="headerlink" href="#guessing" title="Permalink to this headline">¶</a></h4>
<p>Even though it seems obvious to a human, parsing this table to get the right
column names, data values and data types is not trivial.  <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">Asciitable</a> needed
to figure out (or guess):</p>
<ul class="simple">
<li>Overall table format (DAOphot, CDS, RDB, Basic, etc)</li>
<li>Column delimiter, e.g. space, comma, tab, vertical bar, etc.</li>
<li>Column names (which row, maybe preceded by #)</li>
<li>Quote character (single or double quote)</li>
</ul>
<p>By default <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> will try each format it knows and use the first one
that gives a &#8220;reasonable&#8221; answer.  The details are in the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#guess-table-format">Guess table format</a> section.
Sometimes it will fail, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">col1 &amp; col2</span>
<span class="s">  1  &amp; hi there</span>
<span class="s">  3  &amp; world</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
<p>This gives an ominous looking stack trace, but actually all that happened is
that <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> guessed every format it knows and nothing worked.  The
standard set of column delimiters is space, comma, tab, and the vertical bar.
In this case you simply need to give it some help:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;&amp;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The full list of <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#commonly-used-parameters-for-read">table parameters for reading</a> includes common options like
<tt class="docutils literal"><span class="pre">Reader</span></tt>, <tt class="docutils literal"><span class="pre">delimiter</span></tt>, <tt class="docutils literal"><span class="pre">quote_char</span></tt>, and <tt class="docutils literal"><span class="pre">comment</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">Reader</span></tt> option specifies the overall class of table format as documented
in the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#extension-reader-classes">Extension Reader Classes</a> section.</p>
</div>
<div class="section" id="no-guessing">
<h4>No guessing<a class="headerlink" href="#no-guessing" title="Permalink to this headline">¶</a></h4>
<p>For some tricky tables you will want to disable guessing and explicitly provide
the relevant table format information to the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#reading-tables">asciitable.read()</a> function.
A big advantage in this strategy is that <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> can then provide more
detailed information if it still fails to parse the table, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Reader</span><span class="o">=</span><span class="n">asciitable</span><span class="o">.</span><span class="n">Basic</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces a message (after the stacktrace) that should be a pretty good
clue that <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a> is using the wrong column delimiter:</p>
<div class="highlight-python"><pre>InconsistentTableError: Number of header columns (3) inconsistent with data columns (4) at data line 0
Header values: ['col1', '&amp;', 'col2']
Data values: ['1', '&amp;', 'hi', 'there']</pre>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Writing<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>You can write ASCII tables using the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#writing-tables">asciitable.write()</a> function.  There is
a lot of flexibility in the format of the <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#input-data-formats">input data</a> to be
written:</p>
<ul class="simple">
<li>Existing ASCII table with metadata</li>
<li>Data from asciitable.read()</li>
<li>NumPy structured array or record array</li>
<li>Sequence of sequences</li>
<li>Dict of sequences</li>
</ul>
<p>As a first simple example, read a comma-delimited table and then write it out
as space-delimited:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">col1,col2,col3</span>
<span class="s">1,hello world,2.5</span>
<span class="s">3,again,5.0&quot;&quot;&quot;</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">asciitable</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>  <span class="c"># print to terminal instead of to file</span>
</pre></div>
</div>
<p>We can use a different column delimiter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">asciitable</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or a different table writer class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">asciitable</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">Writer</span><span class="o">=</span><span class="n">asciitable</span><span class="o">.</span><span class="n">Latex</span><span class="p">)</span>
</pre></div>
</div>
<p>As a final example, imagine you&#8217;ve gathered basic information about 5 galaxies
which you want to write as an ASCII table.  You could just use pure Python file I/O as
shown earlier, but then you may need to be careful about quoting and formatting (and why
rewrite the same code every time when it is already done!).  Instead just use <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">asciitable</a>:</p>
<div class="highlight-python"><pre>types = ['barred spiral', 'spiral', 'peculiar (ring)', 'elliptical', 'elliptical']
redshifts = array([0.024221, 0.132, 0.22, 0.34, 0.45])
lums = array([1e40, 1.2e40, 2e40, 3e40, 4e40])
table = {'type': types, 'redshift': redshifts, 'lum': lums}

asciitable.write(table, 'galaxies.dat', formats={'redshift': '%.5f', 'lum': '%.2e'})
cat galaxies.dat</pre>
</div>
<div class="admonition-exercise-scraping-table-data-from-the-web admonition ">
<p class="first admonition-title">Exercise: scraping table data from the web</p>
<p>To do this exercise you must first install the <a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> package which will parse
HTML pages into nice data structures.  <strong>QUIT</strong> your IPython session and from the command line do:</p>
<div class="highlight-python"><pre>easy_install [--user] BeautifulSoup</pre>
</div>
<p>Use the <tt class="docutils literal"><span class="pre">--user</span></tt> flag if you prefer to install the package into your local
user area instead of within the system Python installation.</p>
<p>Now start IPython again and define the following function which converts an
HTML table to a list of lines with tab-separated values (this will be more
clear in the next part):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="k">def</span> <span class="nf">html2tsv</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse the index&#39;th HTML table in ``html``.  Return table as a list of</span>
<span class="sd">    tab-separated ASCII table lines&quot;&quot;&quot;</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;table&#39;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">):</span>
        <span class="n">colvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)]</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colvals</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p>Now the exercise is to grab the table data from the <a class="reference external" href="http://hea-www.harvard.edu/XJET/">XJET catalog page</a> into a Python data structure.  You&#8217;ll
want to start with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">asciitable</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&#39;http://hea-www.harvard.edu/XJET/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c"># Get web page as string</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">html2tsv</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c"># Parse the first table in the web page</span>
<span class="n">table2</span> <span class="o">=</span> <span class="n">html2tsv</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># Parse the second table</span>
<span class="n">table3</span> <span class="o">=</span> <span class="n">html2tsv</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c"># Parse the third table</span>
</pre></div>
</div>
<p>Now examine what you got in the <tt class="docutils literal"><span class="pre">table</span></tt> variables and use
<a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#reading-tables">asciitable.read()</a> to parse the right one into a table.  Then plot a
histogram of the redshift distribution in this sample.</p>
<p class="last"><strong>HINT</strong>: the table has missing values so include <tt class="docutils literal"><span class="pre">fill_values=('',</span> <span class="pre">'-1')</span></tt> in
the call to <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable/#reading-tables">asciitable.read()</a>.  <a class="reference external" href="http://cxc.harvard.edu/contrib/asciitable">Asciitable</a> has robust functionality to <a class="reference external" href="http://cxc.cfa.harvard.edu/contrib/asciitable/#replace-bad-or-missing-values">replace bad or
missing values</a>.</p>
</div>
<p class="flip9">Click to Show/Hide Solution</p> <div class="panel9"><p>The data are in the second table, so do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dat</span> <span class="o">=</span> <span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">fill_values</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;-1&#39;</span><span class="p">))</span>
<span class="n">dat</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">dat</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/xjet_hist.png"><img alt="../_images/xjet_hist.png" src="../_images/xjet_hist.png" style="width: 406.0px; height: 306.0px;" /></a>
</div></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="binaryfiles.html" title="Binary formats useful for astronomers"
             >next</a> |</li>
        <li class="right" >
          <a href="../python/types.html" title="Python Built-in Types and Operations"
             >previous</a> |</li>
        <li><a href="../index.html">Python4Astronomers 1.1 documentation</a> &raquo;</li>
          <li><a href="files.html" >Reading and Writing files</a> &raquo;</li> 
      </ul>
    </div>
 <small>Copyright:
 Smithsonian Astrophysical Observatory under terms of
 <a rel="license"
 href="http://creativecommons.org/licenses/by/3.0/">CC
 Attribution 3.0</a></small> <a rel="license"
 href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons
 License" style="border-width:0"
 src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a>

  </body>
</html>